392
278
Training...
Batch loss: -0.3405139446258545
Batch loss: 0.2577376961708069
Batch loss: 0.21463146805763245
Batch loss: -0.08764176070690155
Batch loss: 3.837609052658081
Batch loss: -0.004569840617477894
Batch loss: 0.8103188276290894
Batch loss: 1.7012958526611328
Batch loss: 0.9998540878295898
Batch loss: 0.05216958373785019
Batch loss: 0.9805793762207031
Batch loss: -0.41663509607315063
Batch loss: 0.5785304307937622
Batch loss: 0.43931692838668823
Batch loss: 1.1349055767059326
Batch loss: 2.0187039375305176
Batch loss: 0.1380649358034134
Batch loss: 0.2254587709903717
Batch loss: 3.3278555870056152
Batch loss: 0.48757991194725037
Batch loss: -0.10765217244625092
Batch loss: -0.05712870508432388
Batch loss: 1.3657149076461792
Batch loss: 0.28095459938049316
Batch loss: 0.8967431783676147
Batch loss: 0.6909576654434204
Batch loss: -0.04816514253616333
Batch loss: 2.5097763538360596
Batch loss: 1.0195714235305786
Batch loss: 2.573270797729492
Batch loss: 0.41065531969070435
Batch loss: 0.39856746792793274
Batch loss: -0.4317728579044342
Batch loss: -0.07785878330469131
Batch loss: 0.5814451575279236
Batch loss: -0.6032811403274536
Batch loss: -0.02661316469311714
Traceback (most recent call last):
  File "/home/franlucc/projects/codetrace/train.py", line 284, in <module>
    prompts = [placeholder_to_std_fmt(p, STARCODER_FIM) for p in prompts]
  File "/home/franlucc/projects/codetrace/train.py", line 205, in train_loop
    inpt = causal_mask.to(device=model.device, dtype=model.conv1.weight.dtype)
  File "/home/franlucc/projects/codetrace/train.py", line 80, in apply_mask
    with llm.generate(max_new_tokens=1,
  File "/home/franlucc/venvs/gpu/lib/python3.10/site-packages/nnsight/contexts/Runner.py", line 73, in __exit__
    self.run_local()
  File "/home/franlucc/venvs/gpu/lib/python3.10/site-packages/nnsight/contexts/Runner.py", line 78, in run_local
    self.output = self.model(
  File "/home/franlucc/venvs/gpu/lib/python3.10/site-packages/nnsight/models/NNsightModel.py", line 194, in __call__
    output = fn(inputs, *args, **kwargs)
  File "/home/franlucc/venvs/gpu/lib/python3.10/site-packages/nnsight/models/LanguageModel.py", line 166, in _generation
    return super()._generation(
  File "/home/franlucc/venvs/gpu/lib/python3.10/site-packages/nnsight/models/NNsightModel.py", line 412, in _generation
    return self.local_model.generate(
  File "/home/franlucc/venvs/gpu/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/home/franlucc/venvs/gpu/lib/python3.10/site-packages/transformers/generation/utils.py", line 1474, in generate
    return self.greedy_search(
  File "/home/franlucc/venvs/gpu/lib/python3.10/site-packages/transformers/generation/utils.py", line 2335, in greedy_search
    outputs = self(
  File "/home/franlucc/venvs/gpu/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/franlucc/venvs/gpu/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1568, in _call_impl
    result = forward_call(*args, **kwargs)
  File "/home/franlucc/venvs/gpu/lib/python3.10/site-packages/accelerate/hooks.py", line 165, in new_forward
    output = module._old_forward(*args, **kwargs)
  File "/home/franlucc/venvs/gpu/lib/python3.10/site-packages/transformers/models/gpt_bigcode/modeling_gpt_bigcode.py", line 1265, in forward
    transformer_outputs = self.transformer(
  File "/home/franlucc/venvs/gpu/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/franlucc/venvs/gpu/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/franlucc/venvs/gpu/lib/python3.10/site-packages/transformers/models/gpt_bigcode/modeling_gpt_bigcode.py", line 1118, in forward
    outputs = block(
  File "/home/franlucc/venvs/gpu/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/franlucc/venvs/gpu/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/franlucc/venvs/gpu/lib/python3.10/site-packages/accelerate/hooks.py", line 165, in new_forward
    output = module._old_forward(*args, **kwargs)
  File "/home/franlucc/venvs/gpu/lib/python3.10/site-packages/transformers/models/gpt_bigcode/modeling_gpt_bigcode.py", line 727, in forward
    attn_outputs = self.attn(
  File "/home/franlucc/venvs/gpu/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/franlucc/venvs/gpu/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/franlucc/venvs/gpu/lib/python3.10/site-packages/accelerate/hooks.py", line 165, in new_forward
    output = module._old_forward(*args, **kwargs)
  File "/home/franlucc/venvs/gpu/lib/python3.10/site-packages/transformers/models/gpt_bigcode/modeling_gpt_bigcode.py", line 643, in forward
    attn_output, attn_weights = super()._attn(query, key.transpose(-1, -2), value, attention_mask, head_mask)
  File "/home/franlucc/venvs/gpu/lib/python3.10/site-packages/transformers/models/gpt_bigcode/modeling_gpt_bigcode.py", line 188, in _attn
    attn_weights = torch.empty(attn_view, device=query.device, dtype=query.dtype)
KeyboardInterrupt